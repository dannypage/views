<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Tracking Fireworks Impact on Fourth of July AQI | Danny Page - Page Views</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Tracking Fireworks Impact on Fourth of July AQI" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I’m increasingly of the opinion that fireworks should not be used at all, or at best sparingly in the best conditions for safe dispersal of the pollutants. There are fire risks, limb risks, and breathing risks that come with exploding toxic chemicals in the air. However, America disagrees with me, especially at 8:45 PM local time on July 4th each year." />
<meta property="og:description" content="I’m increasingly of the opinion that fireworks should not be used at all, or at best sparingly in the best conditions for safe dispersal of the pollutants. There are fire risks, limb risks, and breathing risks that come with exploding toxic chemicals in the air. However, America disagrees with me, especially at 8:45 PM local time on July 4th each year." />
<link rel="canonical" href="https://danny.page/views/tracking-fireworks-on-july-4th" />
<meta property="og:url" content="https://danny.page/views/tracking-fireworks-on-july-4th" />
<meta property="og:site_name" content="Danny Page - Page Views" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-07-05T00:00:00+00:00" />
<script type="application/ld+json">
{"description":"I’m increasingly of the opinion that fireworks should not be used at all, or at best sparingly in the best conditions for safe dispersal of the pollutants. There are fire risks, limb risks, and breathing risks that come with exploding toxic chemicals in the air. However, America disagrees with me, especially at 8:45 PM local time on July 4th each year.","url":"https://danny.page/views/tracking-fireworks-on-july-4th","@type":"BlogPosting","headline":"Tracking Fireworks Impact on Fourth of July AQI","dateModified":"2024-07-05T00:00:00+00:00","datePublished":"2024-07-05T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://danny.page/views/tracking-fireworks-on-july-4th"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
  <link rel="stylesheet" href="/views/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://danny.page/views/feed.xml" title="Danny Page - Page Views" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/views/">Danny Page - Page Views</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/views/credits/">Credits</a><a class="page-link" href="/views/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Tracking Fireworks Impact on Fourth of July AQI</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2024-07-05T00:00:00+00:00" itemprop="datePublished">Jul 5, 2024
      </time></p>
  </header>

  <div class="post-content e-content md" itemprop="articleBody">
    <p>I’m increasingly of the opinion that fireworks should not be used at all, or at best sparingly in the best conditions for safe dispersal of the pollutants. There are fire risks, limb risks, and breathing risks that come with exploding toxic chemicals in the air. However, America disagrees with me, especially at 8:45 PM local time on July 4th each year.</p>

<p>I learned about <a href="https://www2.purpleair.com/">PurpleAir</a> after spending a few years in California and having to adjust my life when wildfire smoke was around. The <a href="https://www.airnow.gov/national-maps/">US Government’s Air Quality map</a> usually lags what you can see in the air. Often times I’d open it when it was dreadfully obvious that it was a 150-200 PM2.5 AQI day, and it was still reporting under 100. Only after multiple days of requiring a N95 and clothes smelling like a campfire would it be updated. Fortunately, many people have adjusted by buying PurpleAir monitors and you can see live-to-the-minute information about the air quality around you on the <a href="https://map.purpleair.com/">PurpleAir map.</a></p>

<p><img src="/views/assets/img/fireworks/dc-purpleair.png" alt="" /></p>

<p>Armed with this massive and real-time map, you can see the effects of fireworks can be acutely and suddenly be seen on the national scale. I remembered to check this site after hearing fireworks in the DC area. You can quite clearly see various monitors noting massive rises in the AQI metric in the evening of July 4th.</p>

<p><img src="/views/assets/img/fireworks/dc-purpleair-graph.png" alt="" /></p>

<p>Having missed my chance for watching this unfold in DC, I turned my attention to the San Francisco Bay Area. I setup <a href="https://github.com/simonw/shot-scraper?tab=readme-ov-file">Shot-Scraper</a>, a Python command line library, that opens a headless browser, waits a few second, and then takes a screenshot. I installed the library in its own virtual environment, created a folder for the images, and fired off a few test screenshots to make sure it looked good.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ mkdir purpleair &amp;&amp; cd purpleair
$ python3 -m venv venv 
$ source venv/bin/activate
$ pip install shot-scraper
$ mkdir images
$ shot-scraper https://map.purpleair.com/1/mAQI/a10/p604800/cC0#8.45/37.764/-121.62 --wait 5000 -o ~/Projects/images/bay-area-$(date +%Y%m%d_%H%M%S).png`

</code></pre></div></div>

<p><img src="/views/assets/img/fireworks/bay-area-20240704_220000.png" alt="" /></p>

<p>Here’s what I eventually landed on. The first shot was at 10 PM EDT, or 7 PM local. You could see there were a few hot spots already; unclear if those were fireworks related.</p>

<p>Once I had it creating screenshots via the command line, I needed a script to activate the Python environment and trigger the command.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c">#!/bin/bash</span>
<span class="nb">cd</span> ~/Projects/purpleair
<span class="nb">source </span>venv/bin/activate

shot-scraper https://map.purpleair.com/1/mAQI/a10/p604800/cC0#8.45/37.764/-121.62 <span class="nt">--wait</span> 5000 <span class="nt">-o</span> /Users/dpage/Projects/purpleair/images/bay-area-<span class="si">$(</span><span class="nb">date</span> +%Y%m%d_%H%M%S<span class="si">)</span>.png

</code></pre></div></div>

<p>Using the <code class="highlighter-rouge">$ crontab -e</code> command, I added an entry to fire off that script every minute.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>*/1 * * * * ~/Projects/purpleair/scraper.sh
</code></pre></div></div>

<p>And then I let it run overnight. After 12 hours of running, I had plenty to work with. Using <code class="highlighter-rouge">ffmpeg</code>, I could then combine the images into a 30 second video.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ffmpeg 
	-f image2 
	-pattern_type glob
	-export_path_metadata 1
	-i '*'
	-vf "drawtext=text='%{metadata\:lavf.image2dec.source_basename\:NA}'"
	-r 30 -c:v libx264 -b:v 1M -vf scale=640:-1
	../output.mp4
</code></pre></div></div>

<p><em>Twitter is very particular about what video format it accepts, you may need to <a href="https://stackoverflow.com/questions/59056863/i-cant-upload-this-video-file-mp4-to-twitter">fight with the conversion</a></em></p>

<p>Finally, here is that video! This runs from 7 PM to 7 AM in the San Francisco Bay Area as well as the Central Valley.</p>

<video autoplay="" loop="" muted="" playsinline="" controls="">
    <source src="/views/assets/img/fireworks/output.mp4" />
</video>

<p>You can instantly see the impact of the fireworks. 200+ plus is dangerous for <strong>anyone</strong> if exposed to it for sustained amount of time. 100+ can hit sensitive groups hard. And given the nature of the Bay Area and the Oakland/Fremont hills, the toxic air can hang around. It’s dreadful during wildfire season and makes it all the more questionable that we would do this to ourselves.</p>

  </div>

  <a class="u-url" href="/views/tracking-fireworks-on-july-4th" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/views/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
          <p style="margin-top: .4rem">Danny Page&#39;s articles, code snippets, and other things to store and share.</p>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/dannypage"><svg class="svg-icon"><use xlink:href="/views/assets/minima-social-icons.svg#github"></use></svg> <span class="username">dannypage</span></a></li><li><a href="https://www.twitter.com/dannypage"><svg class="svg-icon"><use xlink:href="/views/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">dannypage</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <ul class="contact-list"><li>Get in contact: <a class="u-email" href="mailto:daniel.w.page@gmail.com">daniel.w.page@gmail.com</a></li><li><a href="https://danny.page/">Danny Page's Portfolio
        </ul>
      </div>

    </div>

  </div>

</footer>
</body>

</html>
